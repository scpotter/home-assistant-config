# conf-PDU.yaml
# Rack PDU configuration following entity naming (rack_pdu_*)
#
# SNMP Outlet Switches
# ---- Raw SNMP switches (backend control) ----
switch:
  - platform: snmp
    name: "rack_pdu_outlet_1"
    host: !secret PDU_IPv4
    community: !secret PDU_community
    baseoid: .1.3.6.1.4.1.318.1.1.4.4.2.1.3.1
    payload_on: 1
    payload_off: 2
  - platform: snmp
    name: "rack_pdu_outlet_2"
    host: !secret PDU_IPv4
    community: !secret PDU_community
    baseoid: .1.3.6.1.4.1.318.1.1.4.4.2.1.3.2
    payload_on: 1
    payload_off: 2
  - platform: snmp
    name: "rack_pdu_outlet_3"
    host: !secret PDU_IPv4
    community: !secret PDU_community
    baseoid: .1.3.6.1.4.1.318.1.1.4.4.2.1.3.3
    payload_on: 1
    payload_off: 2
  - platform: snmp
    name: "rack_pdu_outlet_4"
    host: !secret PDU_IPv4
    community: !secret PDU_community
    baseoid: .1.3.6.1.4.1.318.1.1.4.4.2.1.3.4
    payload_on: 1
    payload_off: 2
  - platform: snmp
    name: "rack_pdu_outlet_5"
    host: !secret PDU_IPv4
    community: !secret PDU_community
    baseoid: .1.3.6.1.4.1.318.1.1.4.4.2.1.3.5
    payload_on: 1
    payload_off: 2
  - platform: snmp
    name: "rack_pdu_outlet_6"
    host: !secret PDU_IPv4
    community: !secret PDU_community
    baseoid: .1.3.6.1.4.1.318.1.1.4.4.2.1.3.6
    payload_on: 1
    payload_off: 2
  - platform: snmp
    name: "rack_pdu_outlet_7"
    host: !secret PDU_IPv4
    community: !secret PDU_community
    baseoid: .1.3.6.1.4.1.318.1.1.4.4.2.1.3.7
    payload_on: 1
    payload_off: 2
  - platform: snmp
    name: "rack_pdu_outlet_8"
    host: !secret PDU_IPv4
    community: !secret PDU_community
    baseoid: .1.3.6.1.4.1.318.1.1.4.4.2.1.3.8
    payload_on: 1
    payload_off: 2

# Template switches (use outlet description sensors if present)
template:
  - switch:
      - name: "Outlet {{ states('sensor.rack_pdu_outlet_1_description') | default('1') }}"
        default_entity_id: switch.rack_pdu_outlet_1_auto
        unique_id: rack_pdu_outlet_1_auto
        state: "{{ is_state('switch.rack_pdu_outlet_1', 'on') }}"
        turn_on:
          service: switch.turn_on
          target:
            entity_id: switch.rack_pdu_outlet_1
        turn_off:
          service: switch.turn_off
          target:
            entity_id: switch.rack_pdu_outlet_1

      - name: "Outlet {{ states('sensor.rack_pdu_outlet_2_description') | default('2') }}"
        default_entity_id: switch.rack_pdu_outlet_2_auto
        unique_id: rack_pdu_outlet_2_auto
        state: "{{ is_state('switch.rack_pdu_outlet_2', 'on') }}"
        turn_on:
          service: switch.turn_on
          target:
            entity_id: switch.rack_pdu_outlet_2
        turn_off:
          service: switch.turn_off
          target:
            entity_id: switch.rack_pdu_outlet_2

      - name: "Outlet {{ states('sensor.rack_pdu_outlet_3_description') | default('3') }}"
        default_entity_id: switch.rack_pdu_outlet_3_auto
        unique_id: rack_pdu_outlet_3_auto
        state: "{{ is_state('switch.rack_pdu_outlet_3', 'on') }}"
        turn_on:
          service: switch.turn_on
          target:
            entity_id: switch.rack_pdu_outlet_3
        turn_off:
          service: switch.turn_off
          target:
            entity_id: switch.rack_pdu_outlet_3

      - name: "Outlet {{ states('sensor.rack_pdu_outlet_4_description') | default('4') }}"
        default_entity_id: switch.rack_pdu_outlet_4_auto
        unique_id: rack_pdu_outlet_4_auto
        state: "{{ is_state('switch.rack_pdu_outlet_4', 'on') }}"
        turn_on:
          service: switch.turn_on
          target:
            entity_id: switch.rack_pdu_outlet_4
        turn_off:
          service: switch.turn_off
          target:
            entity_id: switch.rack_pdu_outlet_4

      - name: "Outlet {{ states('sensor.rack_pdu_outlet_5_description') | default('5') }}"
        default_entity_id: switch.rack_pdu_outlet_5_auto
        unique_id: rack_pdu_outlet_5_auto
        state: "{{ is_state('switch.rack_pdu_outlet_5', 'on') }}"
        turn_on:
          service: switch.turn_on
          target:
            entity_id: switch.rack_pdu_outlet_5
        turn_off:
          service: switch.turn_off
          target:
            entity_id: switch.rack_pdu_outlet_5

      - name: "Outlet {{ states('sensor.rack_pdu_outlet_6_description') | default('6') }}"
        default_entity_id: switch.rack_pdu_outlet_6_auto
        unique_id: rack_pdu_outlet_6_auto
        state: "{{ is_state('switch.rack_pdu_outlet_6', 'on') }}"
        turn_on:
          service: switch.turn_on
          target:
            entity_id: switch.rack_pdu_outlet_6
        turn_off:
          service: switch.turn_off
          target:
            entity_id: switch.rack_pdu_outlet_6

      - name: "Outlet {{ states('sensor.rack_pdu_outlet_7_description') | default('7') }}"
        default_entity_id: switch.rack_pdu_outlet_7_auto
        unique_id: rack_pdu_outlet_7_auto
        state: "{{ is_state('switch.rack_pdu_outlet_7', 'on') }}"
        turn_on:
          service: switch.turn_on
          target:
            entity_id: switch.rack_pdu_outlet_7
        turn_off:
          service: switch.turn_off
          target:
            entity_id: switch.rack_pdu_outlet_7

      - name: "Outlet {{ states('sensor.rack_pdu_outlet_8_description') | default('8') }}"
        default_entity_id: switch.rack_pdu_outlet_8_auto
        unique_id: rack_pdu_outlet_8_auto
        state: "{{ is_state('switch.rack_pdu_outlet_8', 'on') }}"
        turn_on:
          service: switch.turn_on
          target:
            entity_id: switch.rack_pdu_outlet_8
        turn_off:
          service: switch.turn_off
          target:
            entity_id: switch.rack_pdu_outlet_8
